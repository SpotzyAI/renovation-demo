<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Home Renovation Consultation - Florida</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
            border: 1px solid #f0f0f0;
            max-width: 500px;
            width: 100%;
            padding: 40px;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .subtitle {
            color: #666;
            font-size: 16px;
            line-height: 1.5;
        }

        .benefits {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
        }

        .benefit-item {
            display: flex;
            align-items: center;
            margin: 12px 0;
            color: #333;
        }

        .benefit-item::before {
            content: "âœ“";
            color: #333;
            font-weight: bold;
            font-size: 20px;
            margin-right: 12px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        input[type="tel"],
        input[type="text"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .phone-input-wrapper {
            display: flex;
            gap: 10px;
        }

        .country-selector {
            position: relative;
            width: 140px;
        }

        .country-select-button {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .country-select-button:hover {
            border-color: #333;
        }

        .country-flag {
            font-size: 24px;
            margin-right: 8px;
        }

        .country-code {
            color: #666;
            font-size: 14px;
        }

        .dropdown-arrow {
            margin-left: auto;
            color: #999;
        }

        .country-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            margin-top: 5px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .country-dropdown.active {
            display: block;
        }

        .country-search {
            position: sticky;
            top: 0;
            background: white;
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .country-search input {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .country-option {
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background 0.2s ease;
        }

        .country-option:hover {
            background: #f8f9fa;
        }

        .country-option .country-flag {
            margin-right: 12px;
        }

        .country-name {
            flex: 1;
            font-size: 14px;
            color: #333;
        }

        .country-option .country-code {
            font-size: 13px;
        }

        .custom-code-input {
            display: none;
            padding: 10px 15px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
        }

        .custom-code-input.active {
            display: block;
        }

        .custom-code-input input {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .custom-code-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            display: block;
        }

        #phone {
            flex: 1;
        }

        input[type="tel"]:focus,
        input[type="text"]:focus {
            outline: none;
            border-color: #333;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.05);
        }

        .submit-btn {
            width: 100%;
            padding: 16px;
            background: #000000;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
            margin-top: 10px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            background: #222222;
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .privacy-text {
            text-align: center;
            font-size: 12px;
            color: #999;
            margin-top: 20px;
            line-height: 1.5;
        }

        .success-message {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .success-message.active {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        .success-icon {
            font-size: 70px;
            margin-bottom: 20px;
        }

        .success-message h2 {
            color: #333;
            margin-bottom: 15px;
        }

        .success-message p {
            color: #666;
            font-size: 16px;
            line-height: 1.6;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
            font-size: 14px;
        }

        .error-message.active {
            display: block;
        }

        .phone-error {
            color: #c33;
            font-size: 13px;
            margin-top: 5px;
            display: none;
        }

        .phone-error.active {
            display: block;
        }

        input.error {
            border-color: #c33 !important;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 16px 24px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 2000;
            animation: slideInRight 0.3s ease-out;
            max-width: 350px;
        }

        .notification.active {
            display: flex;
        }

        .notification-icon {
            font-size: 24px;
        }

        .notification-text {
            flex: 1;
            font-size: 14px;
            line-height: 1.4;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .required-indicator {
            color: #e74c3c;
            margin-left: 4px;
        }

        @media (max-width: 600px) {
            .container {
                padding: 30px 20px;
            }

            h1 {
                font-size: 24px;
            }

            .subtitle {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="formSection">
            <div class="header">
                <div class="icon">ğŸ </div>
                <h1>Get Your Free Home Renovation Consultation</h1>
                <p class="subtitle">Transform your space with expert guidance. Enter your information and we'll call you back as soon as possible!</p>
            </div>

            <form id="callbackForm">
                <div class="form-group">
                    <label for="name">Your Name <span class="required-indicator">*</span></label>
                    <input 
                        type="text" 
                        id="name" 
                        name="name" 
                        placeholder="John Smith" 
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="phone">Phone Number <span class="required-indicator">*</span></label>
                    <div class="phone-input-wrapper">
                        <div class="country-selector">
                            <button type="button" class="country-select-button" id="countrySelectBtn">
                                <span>
                                    <span class="country-flag" id="selectedFlag">ğŸŒ</span>
                                    <span class="country-code" id="selectedCode">Select</span>
                                </span>
                                <span class="dropdown-arrow">â–¼</span>
                            </button>
                            <div class="country-dropdown" id="countryDropdown">
                                <div class="country-search">
                                    <input type="text" id="countrySearch" placeholder="Search country...">
                                </div>
                                <div id="countryList"></div>
                                <div class="custom-code-input" id="customCodeInput">
                                    <label class="custom-code-label">Enter custom country code (e.g., +123)</label>
                                    <input type="text" id="customCode" placeholder="+123">
                                </div>
                            </div>
                        </div>
                        <input 
                            type="tel" 
                            id="phone" 
                            name="phone" 
                            placeholder="Select country first" 
                            required
                            disabled
                        >
                    </div>
                    <div class="phone-error" id="phoneError"></div>
                </div>

                <div class="form-group">
                    <label for="address">Property Address <span class="required-indicator">*</span></label>
                    <input 
                        type="text" 
                        id="address" 
                        name="address" 
                        placeholder="123 Main Street, City, FL 33XXX"
                        value="1524 Northeast 182nd Street, North Miami Beach, FL 33162"
                        required
                    >
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">
                    <span id="btnText">ğŸ“ Call Me Now</span>
                    <span id="btnLoading" style="display: none;"><span class="loading"></span></span>
                </button>

                <div class="error-message" id="errorMessage"></div>
            </form>

            <p class="privacy-text">
                ğŸ”’ Your information is secure and will only be used to contact you about your renovation project.
            </p>
        </div>

        <div id="successSection" class="success-message">
            <div class="success-icon">âœ…</div>
            <h2>Request Submitted!</h2>
            <p>Thank you for your request! We will call you as soon as possible. Sometimes it might take up to 5 minutes. Please keep your phone nearby and ready to answer.</p>
            <p style="margin-top: 15px; font-size: 14px; color: #999;">
                Don't see a call? Check your phone for incoming calls.
            </p>
            <button class="submit-btn" id="backBtn" style="margin-top: 25px; background: #666;">
                â† Back to Form
            </button>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <span class="notification-icon">ğŸ“</span>
        <span class="notification-text" id="notificationText"></span>
    </div>

    <script>
        // ========================================
        // COUNTRY DATA WITH FLAGS - EXTENDED LIST
        // ========================================
        const countries = [
            // Mediterranean & Middle East
            { name: "Cyprus", code: "+357", flag: "ğŸ‡¨ğŸ‡¾", phoneLength: 8 },
            { name: "Greece", code: "+30", flag: "ğŸ‡¬ğŸ‡·", phoneLength: 10 },
            { name: "Israel", code: "+972", flag: "ğŸ‡®ğŸ‡±", phoneLength: 9 },
            { name: "Turkey", code: "+90", flag: "ğŸ‡¹ğŸ‡·", phoneLength: 10 },
            { name: "Lebanon", code: "+961", flag: "ğŸ‡±ğŸ‡§", phoneLength: 8 },
            { name: "Jordan", code: "+962", flag: "ğŸ‡¯ğŸ‡´", phoneLength: 9 },
            { name: "Egypt", code: "+20", flag: "ğŸ‡ªğŸ‡¬", phoneLength: 10 },
            { name: "Saudi Arabia", code: "+966", flag: "ğŸ‡¸ğŸ‡¦", phoneLength: 9 },
            { name: "United Arab Emirates", code: "+971", flag: "ğŸ‡¦ğŸ‡ª", phoneLength: 9 },
            
            // Europe
            { name: "United Kingdom", code: "+44", flag: "ğŸ‡¬ğŸ‡§", phoneLength: 10 },
            { name: "Germany", code: "+49", flag: "ğŸ‡©ğŸ‡ª", phoneLength: 11 },
            { name: "France", code: "+33", flag: "ğŸ‡«ğŸ‡·", phoneLength: 9 },
            { name: "Italy", code: "+39", flag: "ğŸ‡®ğŸ‡¹", phoneLength: 10 },
            { name: "Spain", code: "+34", flag: "ğŸ‡ªğŸ‡¸", phoneLength: 9 },
            { name: "Romania", code: "+40", flag: "ğŸ‡·ğŸ‡´", phoneLength: 9 },
            { name: "Poland", code: "+48", flag: "ğŸ‡µğŸ‡±", phoneLength: 9 },
            { name: "Netherlands", code: "+31", flag: "ğŸ‡³ğŸ‡±", phoneLength: 9 },
            { name: "Belgium", code: "+32", flag: "ğŸ‡§ğŸ‡ª", phoneLength: 9 },
            { name: "Switzerland", code: "+41", flag: "ğŸ‡¨ğŸ‡­", phoneLength: 9 },
            { name: "Austria", code: "+43", flag: "ğŸ‡¦ğŸ‡¹", phoneLength: 10 },
            { name: "Portugal", code: "+351", flag: "ğŸ‡µğŸ‡¹", phoneLength: 9 },
            { name: "Sweden", code: "+46", flag: "ğŸ‡¸ğŸ‡ª", phoneLength: 9 },
            { name: "Norway", code: "+47", flag: "ğŸ‡³ğŸ‡´", phoneLength: 8 },
            { name: "Denmark", code: "+45", flag: "ğŸ‡©ğŸ‡°", phoneLength: 8 },
            { name: "Finland", code: "+358", flag: "ğŸ‡«ğŸ‡®", phoneLength: 9 },
            { name: "Ireland", code: "+353", flag: "ğŸ‡®ğŸ‡ª", phoneLength: 9 },
            { name: "Czech Republic", code: "+420", flag: "ğŸ‡¨ğŸ‡¿", phoneLength: 9 },
            { name: "Hungary", code: "+36", flag: "ğŸ‡­ğŸ‡º", phoneLength: 9 },
            { name: "Bulgaria", code: "+359", flag: "ğŸ‡§ğŸ‡¬", phoneLength: 9 },
            { name: "Croatia", code: "+385", flag: "ğŸ‡­ğŸ‡·", phoneLength: 9 },
            { name: "Serbia", code: "+381", flag: "ğŸ‡·ğŸ‡¸", phoneLength: 9 },
            { name: "Ukraine", code: "+380", flag: "ğŸ‡ºğŸ‡¦", phoneLength: 9 },
            { name: "Russia", code: "+7", flag: "ğŸ‡·ğŸ‡º", phoneLength: 10 },
            { name: "Slovakia", code: "+421", flag: "ğŸ‡¸ğŸ‡°", phoneLength: 9 },
            { name: "Slovenia", code: "+386", flag: "ğŸ‡¸ğŸ‡®", phoneLength: 9 },
            { name: "Lithuania", code: "+370", flag: "ğŸ‡±ğŸ‡¹", phoneLength: 8 },
            { name: "Latvia", code: "+371", flag: "ğŸ‡±ğŸ‡»", phoneLength: 8 },
            { name: "Estonia", code: "+372", flag: "ğŸ‡ªğŸ‡ª", phoneLength: 8 },
            
            // North America
            { name: "United States", code: "+1", flag: "ğŸ‡ºğŸ‡¸", phoneLength: 10 },
            { name: "Canada", code: "+1", flag: "ğŸ‡¨ğŸ‡¦", phoneLength: 10 },
            { name: "Mexico", code: "+52", flag: "ğŸ‡²ğŸ‡½", phoneLength: 10 },
            
            // Asia-Pacific
            { name: "Australia", code: "+61", flag: "ğŸ‡¦ğŸ‡º", phoneLength: 9 },
            { name: "New Zealand", code: "+64", flag: "ğŸ‡³ğŸ‡¿", phoneLength: 9 },
            { name: "Japan", code: "+81", flag: "ğŸ‡¯ğŸ‡µ", phoneLength: 10 },
            { name: "China", code: "+86", flag: "ğŸ‡¨ğŸ‡³", phoneLength: 11 },
            { name: "South Korea", code: "+82", flag: "ğŸ‡°ğŸ‡·", phoneLength: 10 },
            { name: "India", code: "+91", flag: "ğŸ‡®ğŸ‡³", phoneLength: 10 },
            { name: "Singapore", code: "+65", flag: "ğŸ‡¸ğŸ‡¬", phoneLength: 8 },
            { name: "Thailand", code: "+66", flag: "ğŸ‡¹ğŸ‡­", phoneLength: 9 },
            { name: "Malaysia", code: "+60", flag: "ğŸ‡²ğŸ‡¾", phoneLength: 10 },
            { name: "Philippines", code: "+63", flag: "ğŸ‡µğŸ‡­", phoneLength: 10 },
            { name: "Indonesia", code: "+62", flag: "ğŸ‡®ğŸ‡©", phoneLength: 11 },
            { name: "Vietnam", code: "+84", flag: "ğŸ‡»ğŸ‡³", phoneLength: 9 },
            { name: "Hong Kong", code: "+852", flag: "ğŸ‡­ğŸ‡°", phoneLength: 8 },
            { name: "Taiwan", code: "+886", flag: "ğŸ‡¹ğŸ‡¼", phoneLength: 9 },
            
            // South America
            { name: "Brazil", code: "+55", flag: "ğŸ‡§ğŸ‡·", phoneLength: 11 },
            { name: "Argentina", code: "+54", flag: "ğŸ‡¦ğŸ‡·", phoneLength: 10 },
            { name: "Chile", code: "+56", flag: "ğŸ‡¨ğŸ‡±", phoneLength: 9 },
            { name: "Colombia", code: "+57", flag: "ğŸ‡¨ğŸ‡´", phoneLength: 10 },
            { name: "Peru", code: "+51", flag: "ğŸ‡µğŸ‡ª", phoneLength: 9 },
            
            // Africa
            { name: "South Africa", code: "+27", flag: "ğŸ‡¿ğŸ‡¦", phoneLength: 9 },
            { name: "Nigeria", code: "+234", flag: "ğŸ‡³ğŸ‡¬", phoneLength: 10 },
            { name: "Kenya", code: "+254", flag: "ğŸ‡°ğŸ‡ª", phoneLength: 9 },
            { name: "Morocco", code: "+212", flag: "ğŸ‡²ğŸ‡¦", phoneLength: 9 },
            
            // Other / Custom Code Option
            { name: "Other / Custom Code", code: "custom", flag: "ğŸŒ", phoneLength: null }
        ];

        // Array of sample Florida addresses for randomization
        const floridaAddresses = [
            "1524 Northeast 182nd Street, North Miami Beach, FL 33162",
            "7856 SW 152nd Avenue, Miami, FL 33193",
            "3421 Northwest 36th Street, Miami, FL 33142",
            "9823 Sunset Drive, Miami, FL 33173",
            "4567 Collins Avenue, Miami Beach, FL 33140",
            "2341 Biscayne Boulevard, Miami, FL 33137",
            "6789 SW 8th Street, Miami, FL 33144",
            "5432 NW 7th Street, Miami, FL 33126",
            "8901 Coral Way, Miami, FL 33165",
            "1234 Ocean Drive, Miami Beach, FL 33139",
            "4810 Southwest 152nd Place, Miami, FL 33185",
            "6831 West 14th Court, Hialeah, FL 33014",
            "15770 Cypress Creek Lane, Wellington, FL 33414",
            "323 Chatham Street, West Palm Beach, FL 33417",
            "7171 Southwest 9th Street, Pembroke Pines, FL 33023"
        ];

        // ========================================
        // CONFIGURATION FOR YOUR SPOTZY AGENT
        // ========================================
        const SPOTZY_CONFIG = {
            // Call API settings
            apiUrl: 'https://platform.spotzyai.com/api/user/make_call',
            assistantId: 7018, // <-- CHANGE THIS TO YOUR AGENT'S ID
            apiKey: '628|Mtyo039FY3usr1NInQqUqMZclnqlFAHV1cQrRZVU27730212', // <-- CHANGE THIS TO YOUR API KEY
            
            // Lead API settings  
            leadApiUrl: 'https://platform.spotzyai.com/api/user/lead',
            campaignId: 4425, // <-- YOUR CAMPAIGN ID
            leadApiKey: '682|HB0B2KNZqKHYyOsj72qo8l7vLU1ZbHpKhXvkwWk9d4bb7596', // <-- YOUR LEAD API KEY
            
            // Make.com Webhook
            webhookUrl: 'https://hook.eu2.make.com/as9hhqsp6usr04kcppa3prdkdyav58ep',
            webhookSecret: 'spotzy_secret_2024' // Secret token for verification
        };

        // Set a random Florida address on page load
        window.addEventListener('DOMContentLoaded', function() {
            const addressInput = document.getElementById('address');
            const randomIndex = Math.floor(Math.random() * floridaAddresses.length);
            addressInput.value = floridaAddresses[randomIndex];
        });

        // Country selector elements
        const countrySelectBtn = document.getElementById('countrySelectBtn');
        const countryDropdown = document.getElementById('countryDropdown');
        const countrySearch = document.getElementById('countrySearch');
        const countryList = document.getElementById('countryList');
        const selectedFlag = document.getElementById('selectedFlag');
        const selectedCode = document.getElementById('selectedCode');
        const customCodeInput = document.getElementById('customCodeInput');
        const customCode = document.getElementById('customCode');
        
        // Form elements
        const form = document.getElementById('callbackForm');
        const submitBtn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const btnLoading = document.getElementById('btnLoading');
        const errorMessage = document.getElementById('errorMessage');
        const formSection = document.getElementById('formSection');
        const successSection = document.getElementById('successSection');
        const phoneInput = document.getElementById('phone');

        let selectedCountry = null; // NO DEFAULT - User must select
        let isCustomCode = false;

        // Phone error element
        const phoneError = document.getElementById('phoneError');

        // Function to validate phone number based on selected country
        function validatePhoneNumber() {
            const phone = phoneInput.value.replace(/\D/g, '');
            
            // If no country selected
            if (!selectedCountry) {
                phoneError.textContent = 'Please select a country code first';
                phoneError.classList.add('active');
                phoneInput.classList.add('error');
                return false;
            }

            // If custom code, allow any length between 6-15
            if (isCustomCode || selectedCountry.phoneLength === null) {
                if (phone.length < 6) {
                    phoneError.textContent = 'Phone number is too short (minimum 6 digits)';
                    phoneError.classList.add('active');
                    phoneInput.classList.add('error');
                    return false;
                } else if (phone.length > 15) {
                    phoneError.textContent = 'Phone number is too long (maximum 15 digits)';
                    phoneError.classList.add('active');
                    phoneInput.classList.add('error');
                    return false;
                }
            } else {
                // Validate against expected length for this country
                const expectedLength = selectedCountry.phoneLength;
                
                if (phone.length === 0) {
                    phoneError.textContent = 'Phone number is required';
                    phoneError.classList.add('active');
                    phoneInput.classList.add('error');
                    return false;
                } else if (phone.length < expectedLength) {
                    phoneError.textContent = `Phone number should be ${expectedLength} digits (currently ${phone.length})`;
                    phoneError.classList.add('active');
                    phoneInput.classList.add('error');
                    return false;
                } else if (phone.length > expectedLength) {
                    phoneError.textContent = `Phone number should be ${expectedLength} digits, not ${phone.length} digits`;
                    phoneError.classList.add('active');
                    phoneInput.classList.add('error');
                    return false;
                }
            }

            // Valid!
            phoneError.classList.remove('active');
            phoneInput.classList.remove('error');
            return true;
        }

        // Function to update phone placeholder based on country
        function updatePhonePlaceholder() {
            if (!selectedCountry) {
                phoneInput.placeholder = 'Select country first';
                phoneInput.disabled = true;
                return;
            }

            phoneInput.disabled = false;
            
            if (isCustomCode || selectedCountry.phoneLength === null) {
                phoneInput.placeholder = 'Enter phone number';
            } else {
                // Create placeholder with right number of digits
                const digits = '0'.repeat(selectedCountry.phoneLength);
                phoneInput.placeholder = digits.replace(/(\d{3})/g, '$1 ').trim();
            }
        }

        // Render country list
        function renderCountries(filter = '') {
            const filteredCountries = countries.filter(country => 
                country.name.toLowerCase().includes(filter.toLowerCase()) ||
                country.code.includes(filter)
            );

            countryList.innerHTML = filteredCountries.map(country => `
                <div class="country-option" data-code="${country.code}" data-flag="${country.flag}" data-name="${country.name}">
                    <span class="country-flag">${country.flag}</span>
                    <span class="country-name">${country.name}</span>
                    <span class="country-code">${country.code === 'custom' ? '' : country.code}</span>
                </div>
            `).join('');

            // Add click listeners
            document.querySelectorAll('.country-option').forEach(option => {
                option.addEventListener('click', function() {
                    const code = this.dataset.code;
                    
                    if (code === 'custom') {
                        // Show custom code input
                        customCodeInput.classList.add('active');
                        isCustomCode = true;
                        selectedFlag.textContent = this.dataset.flag;
                        customCode.focus();
                    } else {
                        // Regular country selection
                        const countryData = countries.find(c => c.code === code && c.name === this.dataset.name);
                        selectedCountry = countryData;
                        selectedFlag.textContent = selectedCountry.flag;
                        selectedCode.textContent = selectedCountry.code;
                        isCustomCode = false;
                        customCodeInput.classList.remove('active');
                        countryDropdown.classList.remove('active');
                        countrySearch.value = '';
                        
                        // Update placeholder and enable input
                        updatePhonePlaceholder();
                        phoneInput.value = ''; // Clear phone on country change
                        phoneError.classList.remove('active');
                        phoneInput.classList.remove('error');
                        phoneInput.focus();
                    }
                });
            });
        }

        // Handle custom code input
        customCode.addEventListener('input', function() {
            let value = this.value;
            
            // Ensure it starts with +
            if (value && !value.startsWith('+')) {
                value = '+' + value;
            }
            
            // Only allow + and numbers
            value = value.replace(/[^0-9+]/g, '');
            
            // Only allow + at the beginning
            if (value.split('+').length > 2) {
                value = '+' + value.replace(/\+/g, '');
            }
            
            this.value = value;
            
            // Update selected code display
            if (value && value.length > 1) {
                selectedCode.textContent = value;
                selectedCountry = {
                    name: 'Custom',
                    code: value,
                    flag: 'ğŸŒ',
                    phoneLength: null // Allow flexible length for custom codes
                };
                isCustomCode = true;
                updatePhonePlaceholder();
            }
        });

        // Close custom code input and dropdown when custom code is entered
        customCode.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                if (this.value && this.value.length > 1) {
                    customCodeInput.classList.remove('active');
                    countryDropdown.classList.remove('active');
                    updatePhonePlaceholder();
                    phoneInput.value = '';
                    phoneError.classList.remove('active');
                    phoneInput.classList.remove('error');
                    phoneInput.focus();
                }
            }
        });

        // Toggle dropdown
        countrySelectBtn.addEventListener('click', function(e) {
            e.preventDefault();
            countryDropdown.classList.toggle('active');
            if (countryDropdown.classList.contains('active')) {
                countrySearch.focus();
            } else {
                customCodeInput.classList.remove('active');
            }
        });

        // Search functionality
        countrySearch.addEventListener('input', function() {
            renderCountries(this.value);
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!countrySelectBtn.contains(e.target) && !countryDropdown.contains(e.target)) {
                countryDropdown.classList.remove('active');
                customCodeInput.classList.remove('active');
                countrySearch.value = '';
            }
        });

        // Initialize country list
        renderCountries();

        // Initialize phone input state
        updatePhonePlaceholder();

        // Name input - allow only letters and spaces
        const nameInput = document.getElementById('name');
        
        nameInput.addEventListener('input', function(e) {
            // Remove any non-letter characters except spaces
            this.value = this.value.replace(/[^a-zA-Z\s]/g, '');
        });

        // Format phone number as user types (more flexible for international)
        phoneInput.addEventListener('input', function(e) {
            // Only keep numbers
            this.value = this.value.replace(/\D/g, '');
            
            // Validate as they type
            validatePhoneNumber();
        });

        // Notification function
        function showNotification(message, duration = 5000) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            notification.classList.add('active');
            
            setTimeout(() => {
                notification.classList.remove('active');
            }, duration);
        }

        // Form submission
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const name = document.getElementById('name').value.trim();
            const phone = phoneInput.value.replace(/\D/g, '');
            const address = document.getElementById('address').value.trim();
            
            // Validation
            if (!name || name.length < 2) {
                showError('Please enter a valid name');
                return;
            }

            // Check if country is selected
            if (!selectedCountry) {
                showError('Please select a country code');
                countrySelectBtn.focus();
                return;
            }
            
            // Validate phone number
            if (!validatePhoneNumber()) {
                showError('Please enter a valid phone number for the selected country');
                phoneInput.focus();
                return;
            }

            // Check for blocked numbers (spam numbers)
            const blockedNumbers = [
                { countryCode: '+1', phone: '9123139971', reason: 'This number has been marked as spam and is blocked from receiving calls.' }
            ];

            for (const blocked of blockedNumbers) {
                if (selectedCountry.code === blocked.countryCode && phone === blocked.phone) {
                    showError(`âŒ ${blocked.reason}`);
                    phoneInput.focus();
                    return;
                }
            }

            if (!address || address.length < 10) {
                showError('Please enter a valid address');
                return;
            }

            // Validate custom code if selected
            if (isCustomCode) {
                const customCodeValue = selectedCountry.code;
                if (!customCodeValue || customCodeValue.length < 2 || !customCodeValue.startsWith('+')) {
                    showError('Please enter a valid country code (e.g., +123)');
                    return;
                }
            }

            // Show loading state
            submitBtn.disabled = true;
            btnText.style.display = 'none';
            btnLoading.style.display = 'inline-block';
            errorMessage.classList.remove('active');

            // Show notification immediately
            showNotification('â³ Processing your request... We will call you as soon as possible!', 3000);

            try {
                // Format phone with selected country code
                const fullPhoneNumber = `${selectedCountry.code}${phone}`;
                
                // First API call - Make the phone call
                const requestBody = {
                    phone_number: fullPhoneNumber,
                    assistant_id: SPOTZY_CONFIG.assistantId,
                    variables: {
                        customer_name: name,
                        property_address: address
                    }
                };

                // Debug logging
                console.log('ğŸ”µ API Request Details:');
                console.log('URL:', SPOTZY_CONFIG.apiUrl);
                console.log('Assistant ID:', SPOTZY_CONFIG.assistantId);
                console.log('Phone Number:', fullPhoneNumber);
                console.log('Customer Name:', name);
                console.log('Property Address:', address);
                console.log('Full Request Body:', JSON.stringify(requestBody, null, 2));
                
                // Make the call API request
                const callResponse = await fetch(SPOTZY_CONFIG.apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${SPOTZY_CONFIG.apiKey}`
                    },
                    body: JSON.stringify(requestBody)
                });

                console.log('ğŸ”µ Call API Response Status:', callResponse.status);
                
                const callData = await callResponse.json();
                console.log('ğŸ”µ Call API Response Data:', callData);

                // Second API call - Save lead data
                const leadRequestBody = {
                    phone_number: fullPhoneNumber,
                    campaign_id: SPOTZY_CONFIG.campaignId,
                    variables: {
                        customer_name: name,
                        property_address: address
                    },
                    allow_dupplicate: false,
                    customer_name: name,
                    property_address: address
                };

                console.log('ğŸ“Š Saving lead data...');
                
                // Save lead API request
                const leadResponse = await fetch(SPOTZY_CONFIG.leadApiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${SPOTZY_CONFIG.leadApiKey}`
                    },
                    body: JSON.stringify(leadRequestBody)
                });

                const leadData = await leadResponse.json();
                console.log('ğŸ“Š Lead API Response:', leadData);

                // Third API call - Send to Make.com Webhook
                console.log('ğŸ”— Sending data to Make.com webhook...');
                
                // Validate required fields before sending
                if (!name || !fullPhoneNumber || !address) {
                    console.error('âŒ Missing required fields for webhook');
                } else {
                    const webhookData = {
                        customer_name: name,
                        phone_number: fullPhoneNumber,
                        property_address: address,
                        timestamp: new Date().toISOString(),
                        source: 'renovation_form',
                        secret: SPOTZY_CONFIG.webhookSecret // For verification in Make.com
                    };

                    try {
                        const webhookResponse = await fetch(SPOTZY_CONFIG.webhookUrl, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(webhookData)
                        });
                        
                        if (webhookResponse.ok) {
                            console.log('âœ… Webhook triggered successfully');
                            console.log('ğŸ“¤ Data sent:', webhookData);
                        } else {
                            console.warn('âš ï¸ Webhook failed but continuing...', webhookResponse.status);
                        }
                    } catch (webhookError) {
                        console.warn('âš ï¸ Webhook error (non-critical):', webhookError);
                    }
                }

                // Check both responses
                if (callResponse.ok && leadResponse.ok) {
                    // Both successful!
                    console.log('âœ… Call initiated and lead saved successfully');
                    showNotification('âœ… Success! Your request has been received. We will call you as soon as possible (up to 5 minutes). Please keep your phone nearby!', 8000);
                    
                    // Wait a bit before showing success screen
                    setTimeout(() => {
                        formSection.style.display = 'none';
                        successSection.classList.add('active');
                    }, 1000);
                } else if (callResponse.ok && !leadResponse.ok) {
                    // Call worked but lead save failed - still show success since call is more important
                    console.warn('âš ï¸ Call initiated but lead save failed');
                    showNotification('âœ… Your request has been received. We will call you as soon as possible (up to 5 minutes). Please keep your phone nearby!', 8000);
                    
                    setTimeout(() => {
                        formSection.style.display = 'none';
                        successSection.classList.add('active');
                    }, 1000);
                } else {
                    // Call failed
                    console.error('âŒ API Error:', callData);
                    throw new Error(callData.message || 'Failed to initiate call');
                }
            } catch (error) {
                console.error('âŒ Error Details:', error);
                showError('Something went wrong. Please try again or call us directly.');
                showNotification('âŒ Error: Could not initiate call. Please try again.', 5000);
                
                // Reset button state
                submitBtn.disabled = false;
                btnText.style.display = 'inline-block';
                btnLoading.style.display = 'none';
            }
        });

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.add('active');
            setTimeout(() => {
                errorMessage.classList.remove('active');
            }, 5000);
        }

        // Back button functionality
        document.getElementById('backBtn').addEventListener('click', function() {
            // Hide success section
            successSection.classList.remove('active');
            
            // Show form section
            formSection.style.display = 'block';
            
            // Reset form but keep the same address
            const currentAddress = document.getElementById('address').value;
            form.reset();
            document.getElementById('address').value = currentAddress;
            
            // Reset country selector to no selection
            selectedCountry = null;
            selectedFlag.textContent = 'ğŸŒ';
            selectedCode.textContent = 'Select';
            isCustomCode = false;
            customCodeInput.classList.remove('active');
            phoneInput.disabled = true;
            phoneInput.placeholder = 'Select country first';
            phoneError.classList.remove('active');
            phoneInput.classList.remove('error');
            
            // Reset button state
            submitBtn.disabled = false;
            btnText.style.display = 'inline-block';
            btnLoading.style.display = 'none';
            
            // Clear any errors
            errorMessage.classList.remove('active');
        });
    </script>
</body>
</html>
